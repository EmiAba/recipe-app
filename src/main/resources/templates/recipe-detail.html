<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Details - Recipe Buddy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link th:href="@{/css/one.css}" rel="stylesheet">
</head>
<body>

<div class="dashboard-container">
    <!-- Sidebar Navigation -->
    <div th:replace="~{fragments/navbar::navbar}"></div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Top Navigation Bar -->
        <nav class="top-navbar">
            <div class="container-fluid">
                <div class="d-flex align-items-center">
                </div>
                <div class="d-flex align-items-center">
                    <div th:replace="~{fragments/profile-menu :: profile-menu}"></div>
                </div>
            </div>
        </nav>

        <!-- Recipe Detail Content -->
        <div class="dashboard-content">
            <div class="container-fluid py-4">
                <!-- Recipe Action Buttons -->
                <div class="d-flex justify-content-between align-items-center mb-4">

                    <div>
                        <form th:if="${!isFavorite}" th:action="@{'/recipes/' + ${recipe.id} + '/favorite'}" th:method="post">
                            <button type="submit" class="btn btn-outline-primary">
                                <i class="bi bi-heart"></i> Add to favorites
                            </button>
                        </form>

                        <form th:if="${isFavorite}" th:action="@{'/recipes/' + ${recipe.id} + '/unfavorite'}" th:method="post">
                            <button type="submit" class="btn btn-outline-danger">
                                <i class="bi bi-heart-fill"></i> Remove from favorites
                            </button>
                        </form>
                    </div>

                    <div th:if="${isAuthor}" class="d-flex gap-2">
                        <a th:href="@{'/recipes/edit/' + ${recipe.id}}" class="btn btn-outline-primary">
                            <i class="bi bi-pencil"></i> Edit Recipe
                        </a>

                        <form th:action="@{'/recipes/' + ${recipe.id} + '/delete'}" th:method="delete">
                            <button type="submit" class="btn btn-outline-danger" onclick="return confirm('Are you sure you want to delete this recipe?')">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Recipe Section -->
                <div class="recipe-detail-card">
                    <!-- Recipe Header -->
                    <div class="recipe-header">
                        <h1 th:text="${recipe.title}">Recipe Title</h1>
                        <div class="recipe-meta">
                            <span>
                                <i class="bi bi-person-circle"></i>
                                <span th:text="${recipe.author.username}">Author</span>
                            </span>
                            <span>
                                <i class="bi bi-calendar-check"></i>
                                <span th:text="${#temporals.format(recipe.createdOn, 'MMM dd, yyyy')}">April 28, 2025</span>
                            </span>
                        </div>
                    </div>

                    <!-- Recipe Body -->
                    <div class="row mt-4">
                        <!-- Recipe Image and Details -->
                        <div class="col-lg-5">
                            <div class="recipe-image-container mb-3">
                                <img th:src="${recipe.imageUrl ?: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=800&h=600&fit=crop'}" class="img-fluid rounded" th:alt="${recipe.title}">
                            </div>

                            <!-- Recipe Quick Info -->
                            <div class="recipe-quick-info">
                                <div class="recipe-info-card">
                                    <div class="info-icon">
                                        <i class="bi bi-clock"></i>
                                    </div>
                                    <div class="info-text">
                                        <span class="info-title">Total Time:</span>
                                        <span class="info-value" th:text="${recipe.prepTimeMinutes + recipe.cookTimeMinutes} + ' min'">45 min</span>
                                    </div>
                                </div>

                                <div class="recipe-info-card">
                                    <div class="info-icon">
                                        <i class="bi bi-alarm"></i>
                                    </div>
                                    <div class="info-text">
                                        <span class="info-title">Prep Time:</span>
                                        <span class="info-value" th:text="${recipe.prepTimeMinutes} + ' min'">15 min</span>
                                    </div>
                                </div>

                                <div class="recipe-info-card">
                                    <div class="info-icon">
                                        <i class="bi bi-fire"></i>
                                    </div>
                                    <div class="info-text">
                                        <span class="info-title">Cook Time:</span>
                                        <span class="info-value" th:text="${recipe.cookTimeMinutes} + ' min'">30 min</span>
                                    </div>
                                </div>

                                <div class="recipe-info-card">
                                    <div class="info-icon">
                                        <i class="bi bi-people"></i>
                                    </div>
                                    <div class="info-text">
                                        <span class="info-title">Servings:</span>
                                        <span class="info-value" th:text="${recipe.servingSize}">4</span>
                                    </div>
                                </div>

                                <div class="recipe-info-card">
                                    <div class="info-icon">
                                        <i class="bi bi-bar-chart"></i>
                                    </div>
                                    <div class="info-text">
                                        <span class="info-title">Difficulty:</span>
                                        <span class="info-value" th:text="${#strings.capitalize(#strings.toLowerCase(recipe.difficultyLevel))}">Medium</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Categories -->
                            <div class="mt-4">
                                <h5>Categories:</h5>
                                <div class="recipe-tags">
                                    <span class="tag category-tag"
                                          th:each="category : ${recipe.categories}"
                                          th:text="${#strings.capitalize(category.name)}"
                                          title="Category">Category</span>
                                </div>
                            </div>
                        </div>

                        <!-- Recipe Content -->
                        <div class="col-lg-7">
                            <!-- Recipe Description -->
                            <div class="recipe-section">
                                <h3>Description:</h3>
                                <p th:text="${recipe.description}">Recipe description...</p>
                            </div>

                            <!-- Recipe Ingredients -->
                            <div class="recipe-section">
                                <h3>Ingredients:</h3>
                                <div class="ingredients-list">
                                    <p th:text="${recipe.ingredients}">Ingredients list</p>
                                </div>
                            </div>

                            <!-- Recipe Instructions -->
                            <div class="recipe-section">
                                <h3>Instructions:</h3>
                                <div class="instructions-list">
                                    <p th:text="${recipe.instructions}">Instructions</p>
                                </div>
                            </div>

                            <!-- Nutrition Facts -->
                            <div class="recipe-section" th:if="${recipe.calories != null}">
                                <h3>Nutrition Facts:</h3>
                                <div class="nutrition-facts">
                                    <div class="nutrition-item" th:if="${recipe.calories != null}">
                                        <span class="nutrition-label">Calories:</span>
                                        <span class="nutrition-value" th:text="${recipe.calories} + ' kcal'">350 kcal</span>
                                    </div>
                                    <div class="nutrition-item" th:if="${recipe.protein != null}">
                                        <span class="nutrition-label">Protein:</span>
                                        <span class="nutrition-value" th:text="${recipe.protein} + 'g'">25g</span>
                                    </div>
                                    <div class="nutrition-item" th:if="${recipe.carbs != null}">
                                        <span class="nutrition-label">Carbs:</span>
                                        <span class="nutrition-value" th:text="${recipe.carbs} + 'g'">42g</span>
                                    </div>
                                    <div class="nutrition-item" th:if="${recipe.fat != null}">
                                        <span class="nutrition-label">Fat:</span>
                                        <span class="nutrition-value" th:text="${recipe.fat} + 'g'">12g</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Comment Section -->
                <div class="dashboard-card mt-4" id="comments">
                    <h3 class="mb-3">Reviews & Comments</h3>

                    <div class="comments-section"
                         th:classappend="${#lists.isEmpty(comments)} ? ' no-comments-state' : ' has-comments'">

                        <!-- Overall Rating Summary -->
                        <div class="overall-rating" th:if="${averageRating != null}">
                            <div class="rating-number"
                                 th:text="${#numbers.formatDecimal(averageRating, 1, 1)}">4.5</div>
                            <div class="rating-stars">
                                <span th:each="i : ${#numbers.sequence(1, 5)}"
                                      th:class="${i <= averageRating ? 'bi bi-star-fill' : 'bi bi-star'}"
                                      class="bi bi-star-fill"></span>
                            </div>
                            <div class="rating-count"
                                 th:text="${totalRatings} + ' review' + ${totalRatings != 1 ? 's' : ''}">
                                12 reviews
                            </div>
                        </div>

                        <!-- Comment Form -->
                        <div class="comment-form">
                            <h5 class="mb-3">Leave a Review</h5>

                            <form th:action="@{/comments/recipe/{id}(id=${recipe.id})}"
                                  th:method="post"
                                  th:object="${commentCreateRequest}"
                                  novalidate>



                                <div class="form-group">
                                    <p class="alert-warning" th:if="${#fields.hasErrors('rating')}" th:errors="*{rating}"></p>
                                    <label class="rating-label">Your Rating * : </label>
                                    <div class="rating" aria-label="Rating">
                                        <input class="rating__input" type="radio" id="rate5" th:field="*{rating}" value="5" required>
                                        <label class="rating__label" for="rate5" title="Excellent"></label>

                                        <input class="rating__input" type="radio" id="rate4" th:field="*{rating}" value="4">
                                        <label class="rating__label" for="rate4" title="Good"></label>

                                        <input class="rating__input" type="radio" id="rate3" th:field="*{rating}" value="3">
                                        <label class="rating__label" for="rate3" title="Average"></label>

                                        <input class="rating__input" type="radio" id="rate2" th:field="*{rating}" value="2">
                                        <label class="rating__label" for="rate2" title="Poor"></label>

                                        <input class="rating__input" type="radio" id="rate1" th:field="*{rating}" value="1">
                                        <label class="rating__label" for="rate1" title="Terrible"></label>
                                    </div>
                                    <small class="rating-hint">Click a star to rate this recipe</small>



                                    <!-- Review content -->
                                    <div class="mb-3">
                                        <label class="form-label">Your Review *</label>
                                        <textarea class="form-control"
                                                  th:field="*{content}"
                                                  rows="3"
                                                  placeholder="Share your thoughts (minimum 2 characters)..."></textarea>
                                        <p class="alert-warning" th:if="${#fields.hasErrors('content')}" th:errors="*{content}"></p>
                                    </div>

                                    <div class="text-end">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-send"></i> Post Review
                                        </button>
                                    </div>
                            </form>
                        </div>

                        <!-- Comments List -->
                        <div class="comment-list mt-4" th:if="${not #lists.isEmpty(comments)}">
                            <div class="comment-item mb-4 pb-3 border-bottom" th:each="comment : ${comments}">
                                <div class="comment-header d-flex align-items-center mb-2">
                                    <img th:src="${#strings.isEmpty(comment.author.profilePicture)  ? 'https://ui-avatars.com/api/?name=' + comment.author.username + '&background=FCDA05&color=20470b'
              : comment.author.profilePicture}"  alt="User Avatar"  class="comment-author-img rounded-circle me-3"
                                         width="40" height="40"  style="object-fit: cover; border: 2px solid #FCDA05;">

                                    <div>
                                        <p class="mb-0 fw-bold" th:text="${comment.author.username}">Username</p>
                                        <small class="text-muted" th:text="${#temporals.format(comment.createdOn, 'MMM d, yyyy')}">May 15, 2025</small>
                                    </div>
                                    <div class="ms-auto">
                                        <span th:each="i : ${#numbers.sequence(1, 5)}"
                                              th:class="${i <= comment.rating ? 'bi bi-star-fill text-warning' : 'bi bi-star text-secondary'}"
                                              class="bi bi-star-fill"></span>
                                    </div>
                                </div>
                                <div class="comment-content" th:text="${comment.content}">Comment text…</div>


                                <div class="comment-actions d-flex gap-2 mt-2" >
                                    <a th:href="@{'/comments/' + ${comment.id} + '/edit'}" class="btn btn-sm btn-outline-secondary">
                                        <i class="bi bi-pencil"></i> Edit
                                    </a>

                                    <form th:action="@{/comments/{id}/delete(id=${comment.id})}" th:method="delete" class="d-inline m-0">
                                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this comment?')">
                                            <i class="bi bi-trash"></i> Delete
                                        </button>
                                    </form>
                                </div>
                            </div>







                        </div>

                    </div>
                </div>


            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>