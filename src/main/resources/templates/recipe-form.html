<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Buddy - Add New Recipe</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link th:href="@{/css/one.css}" rel="stylesheet">
</head>
<body>

<div class="dashboard-container">
    <!-- Sidebar Navigation -->
    <div th:replace="~{fragments/navbar::navbar}"></div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Top Navigation Bar -->
        <nav class="top-navbar">
            <div class="container-fluid">
                <div class="d-flex align-items-center"></div>
                <div class="d-flex align-items-center">
                    <div th:replace="~{fragments/profile-menu :: profile-menu}"></div>
                </div>
            </div>
        </nav>

        <!-- Add Recipe Content -->
        <div class="dashboard-content">
            <div class="container-fluid py-4">
                <div class="row">
                    <div class="col-lg-10 mx-auto">
                        <div class="form-container">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h3 class="mb-0">[[#{form.addNewRecipe}]]</h3>
                                <a th:href="@{/recipes/mine}" class="btn btn-sm btn-outline-secondary">
                                    <i class="bi bi-arrow-left"></i> [[#{form.backToRecipes}]]
                                </a>
                            </div>

                            <form th:action="@{/recipes/save}" th:method="post" th:object="${recipeCreateRequest}" enctype="multipart/form-data" novalidate >

                                <!-- Basic Information Section -->
                                <div class="row mb-4">
                                    <div class="col-md-8">
                                        <div class="mb-3">
                                            <label class="form-label">[[#{form.recipeTitle}]]</label>
                                            <input type="text" class="form-control" th:field="*{title}" th:placeholder="#{form.recipeTitlePlaceholder}">
                                            <p class="alert-warning" th:if="${#fields.hasErrors('title')}" th:errors="*{title}"></p>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">[[#{form.description}]]</label>
                                            <textarea class="form-control" th:field="*{description}" rows="3" th:placeholder="#{form.descriptionPlaceholder}"></textarea>
                                            <p class="alert-warning" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></p>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label">[[#{form.prepTime}]]</label>
                                                    <input type="number" class="form-control" th:field="*{prepTimeMinutes}" min="1">
                                                    <p class="alert-warning" th:if="${#fields.hasErrors('prepTimeMinutes')}" th:errors="*{prepTimeMinutes}"></p>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label">[[#{form.cookTime}]]</label>
                                                    <input type="number" class="form-control" th:field="*{cookTimeMinutes}" min="0">
                                                    <p class="alert-warning" th:if="${#fields.hasErrors('cookTimeMinutes')}" th:errors="*{cookTimeMinutes}"></p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">[[#{form.servings}]]</label>
                                            <input type="number" class="form-control" th:field="*{servingSize}" min="1">
                                            <p class="alert-warning" th:if="${#fields.hasErrors('servingSize')}" th:errors="*{servingSize}"></p>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label d-block">[[#{form.difficultyLevel}]]</label>
                                            <div class="difficulty-options">
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" th:field="*{difficultyLevel}" value="EASY" id="easy">
                                                    <label class="form-check-label difficulty-easy" for="easy"><i class="bi bi-star"></i> [[#{form.easy}]]</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" th:field="*{difficultyLevel}" value="MEDIUM" id="medium">
                                                    <label class="form-check-label difficulty-medium" for="medium"><i class="bi bi-star"></i><i class="bi bi-star"></i> [[#{form.medium}]]</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" th:field="*{difficultyLevel}" value="HARD" id="hard">
                                                    <label class="form-check-label difficulty-hard" for="hard"><i class="bi bi-star"></i><i class="bi bi-star"></i><i class="bi bi-star"></i> [[#{form.hard}]]</label>
                                                </div>
                                            </div>
                                            <p class="alert-warning" th:if="${#fields.hasErrors('difficultyLevel')}" th:errors="*{difficultyLevel}"></p>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">[[#{form.recipeImage}]]</label>
                                        <div class="mt-4">
                                            <p class="text-muted">[[#{form.provideImageUrl}]]</p>
                                            <input type="url" class="form-control" th:field="*{imageUrl}" th:placeholder="#{form.imageUrlPlaceholder}">
                                            <div class="form-text">[[#{form.pasteImageLink}]]</div>
                                            <p class="alert-warning" th:if="${#fields.hasErrors('imageUrl')}" th:errors="*{imageUrl}"></p>
                                            <div class="image-preview mt-3" id="imagePreview" style="display: none;">
                                                <img src="" alt="Recipe preview" class="img-fluid rounded" style="max-height: 200px;">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="section-divider"></div>



                                <!-- Ingredients Section -->
                                <h4 class="mb-3">[[#{form.ingredients}]]</h4>
                                <div id="ingredientsContainer">
                                    <div th:each="ingredient, stat : *{recipeIngredients}" class="ingredient-row mb-3">
                                        <div class="row g-2">
                                            <div class="col-md-4">
                                                <label th:for="'ingredientName' + ${stat.index}"
                                                       class="form-label"
                                                       th:text="#{recipe.ingredients.name.label}">Ingredient Name</label>
                                                <input type="text"
                                                       class="form-control"
                                                       th:field="*{recipeIngredients[__${stat.index}__].ingredientName}"
                                                       th:id="'ingredientName' + ${stat.index}"
                                                       th:placeholder="#{recipe.ingredients.name.placeholder}">
                                                <p class="alert-warning"
                                                   th:if="${#fields.hasErrors('recipeIngredients[' + stat.index + '].ingredientName')}"
                                                   th:errors="*{recipeIngredients[__${stat.index}__].ingredientName}"></p>
                                            </div>

                                            <div class="col-md-2">
                                                <label th:for="'quantity' + ${stat.index}"
                                                       class="form-label"
                                                       th:text="#{recipe.ingredients.quantity.label}">Quantity</label>
                                                <input type="text"
                                                       class="form-control"
                                                       th:field="*{recipeIngredients[__${stat.index}__].quantity}"
                                                       th:id="'quantity' + ${stat.index}"
                                                       th:placeholder="#{recipe.ingredients.quantity.placeholder}">
                                                <p class="alert-warning"
                                                   th:if="${#fields.hasErrors('recipeIngredients[' + stat.index + '].quantity')}"
                                                   th:errors="*{recipeIngredients[__${stat.index}__].quantity}"></p>
                                            </div>

                                            <div class="col-md-2">
                                                <label th:for="'unit' + ${stat.index}"
                                                       class="form-label"
                                                       th:text="#{recipe.ingredients.unit.label}">Unit</label>
                                                <select class="form-select"
                                                        th:field="*{recipeIngredients[__${stat.index}__].unit}"
                                                        th:id="'unit' + ${stat.index}">
                                                    <option value="" th:text="#{recipe.ingredients.unit.select}">Select</option>
                                                    <option value="cup" th:text="#{shopping.unit.cup}">Cup</option>
                                                    <option value="tbsp" th:text="#{shopping.unit.tbsp}">Tbsp</option>
                                                    <option value="tsp" th:text="#{shopping.unit.tsp}">Tsp</option>
                                                    <option value="g" th:text="#{shopping.unit.g}">Gram</option>
                                                    <option value="kg" th:text="#{shopping.unit.kg}">Kg</option>
                                                    <option value="ml" th:text="#{shopping.unit.ml}">ml</option>
                                                    <option value="l" th:text="#{shopping.unit.l}">Liter</option>
                                                    <option value="piece" th:text="#{shopping.unit.piece}">Piece</option>
                                                    <option value="clove" th:text="#{shopping.unit.clove}">Clove</option>
                                                    <option value="slice" th:text="#{shopping.unit.slice}">Slice</option>
                                                </select>
                                                <p class="alert-warning"
                                                   th:if="${#fields.hasErrors('recipeIngredients[' + stat.index + '].unit')}"
                                                   th:errors="*{recipeIngredients[__${stat.index}__].unit}"></p>
                                            </div>

                                            <div class="col-md-4">
                                                <label th:for="'notes' + ${stat.index}"
                                                       class="form-label"
                                                       th:text="#{recipe.ingredients.notes.label}">Notes (Optional)</label>
                                                <input type="text"
                                                       class="form-control"
                                                       th:field="*{recipeIngredients[__${stat.index}__].notes}"
                                                       th:id="'notes' + ${stat.index}"
                                                       th:placeholder="#{recipe.ingredients.notes.placeholder}">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-text mb-3">
                                    <i class="bi bi-info-circle"></i>
                                    <span th:text="#{recipe.ingredients.help}">Fill in as many ingredients as needed. Empty rows will be ignored.</span>
                                </div>
                                <!-- Hidden Template for New Ingredient Row -->
                                <template id="ingredient-template">
                                    <div class="ingredient-row mb-3">
                                        <div class="row g-2">
                                            <div class="col-md-4">
                                                <label class="form-label" th:text="#{recipe.ingredients.name.label}">Ingredient Name</label>
                                                <input type="text"
                                                       class="form-control"
                                                       th:placeholder="#{recipe.ingredients.name.placeholder}">
                                            </div>

                                            <div class="col-md-2">
                                                <label class="form-label" th:text="#{recipe.ingredients.quantity.label}">Quantity</label>
                                                <input type="text"
                                                       class="form-control"
                                                       th:placeholder="#{recipe.ingredients.quantity.placeholder}">
                                            </div>

                                            <div class="col-md-2">
                                                <label class="form-label" th:text="#{recipe.ingredients.unit.label}">Unit</label>
                                                <select class="form-select">
                                                    <option value="" th:text="#{recipe.ingredients.unit.select}">Select</option>
                                                    <option value="cup" th:text="#{shopping.unit.cup}">Cup</option>
                                                    <option value="tbsp" th:text="#{shopping.unit.tbsp}">Tbsp</option>
                                                    <option value="tsp" th:text="#{shopping.unit.tsp}">Tsp</option>
                                                    <option value="g" th:text="#{shopping.unit.g}">Gram</option>
                                                    <option value="kg" th:text="#{shopping.unit.kg}">Kg</option>
                                                    <option value="ml" th:text="#{shopping.unit.ml}">ml</option>
                                                    <option value="l" th:text="#{shopping.unit.l}">Liter</option>
                                                    <option value="piece" th:text="#{shopping.unit.piece}">Piece</option>
                                                    <option value="clove" th:text="#{shopping.unit.clove}">Clove</option>
                                                    <option value="slice" th:text="#{shopping.unit.slice}">Slice</option>
                                                </select>
                                            </div>

                                            <div class="col-md-3">
                                                <label class="form-label" th:text="#{recipe.ingredients.notes.label}">Notes (Optional)</label>
                                                <input type="text"
                                                       class="form-control"
                                                       th:placeholder="#{recipe.ingredients.notes.placeholder}">
                                            </div>

                                            <div class="col-md-1 d-flex align-items-end">
                                                <button type="button" class="btn btn-danger btn-sm remove-ingredient">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </template>

                                <span id="addMoreIngredientText" th:text="#{recipe.ingredients.addMore}" style="display: none;"></span>
                                <div class="section-divider"></div>

                                <!-- Instructions Section -->
                                <h4 class="mb-3">[[#{form.instructions}]]</h4>
                                <div class="mb-3">
                                    <textarea class="form-control" th:field="*{instructions}" rows="6" th:placeholder="#{form.instructionsPlaceholder}"></textarea>
                                    <p class="alert-warning" th:if="${#fields.hasErrors('instructions')}" th:errors="*{instructions}"></p>
                                </div>



                                <div class="section-divider"></div>

                                <!-- Categories Section -->
                                <!-- Categories & Dietary Tags Section -->
                                <div class="row g-3">
                                    <!-- Categories Column -->
                                    <div class="col-md-6">
                                        <h4 class="mb-3">[[#{form.categories}]]</h4>
                                        <div class="category-dietary-box">
                                            <p class="text-muted mb-3">Select recipe categories</p>
                                            <div class="category-checkboxes">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{categoryNames}" value="breakfast" id="categoryBreakfast">
                                                    <label class="form-check-label" for="categoryBreakfast">[[#{form.breakfast}]]</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{categoryNames}" value="lunch" id="categoryLunch">
                                                    <label class="form-check-label" for="categoryLunch">[[#{form.lunch}]]</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{categoryNames}" value="dinner" id="categoryDinner">
                                                    <label class="form-check-label" for="categoryDinner">[[#{form.dinner}]]</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{categoryNames}" value="appetizer" id="categoryAppetizer">
                                                    <label class="form-check-label" for="categoryAppetizer">[[#{form.appetizer}]]</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{categoryNames}" value="dessert" id="categoryDessert">
                                                    <label class="form-check-label" for="categoryDessert">[[#{form.dessert}]]</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{categoryNames}" value="snack" id="categorySnack">
                                                    <label class="form-check-label" for="categorySnack">[[#{form.snack}]]</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{categoryNames}" value="drink" id="categoryDrink">
                                                    <label class="form-check-label" for="categoryDrink">[[#{form.drink}]]</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{categoryNames}" value="soup" id="categorySoup">
                                                    <label class="form-check-label" for="categorySoup">[[#{form.soup}]]</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{categoryNames}" value="salad" id="categorySalad">
                                                    <label class="form-check-label" for="categorySalad">[[#{form.salad}]]</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Dietary Tags Column -->
                                    <div class="col-md-6">
                                        <h4 class="mb-3">
                                            <i class="bi bi-heart-pulse text-success"></i> Dietary Preferences
                                        </h4>
                                        <div class="category-dietary-box">
                                            <p class="text-muted mb-3">Select dietary tags that apply</p>
                                            <div class="dietary-checkboxes">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{dietaryTags}" value="VEGETARIAN" id="tagVegetarian">
                                                    <label class="form-check-label" for="tagVegetarian">
                                                        <i class="bi bi-egg-fried"></i> Vegetarian
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{dietaryTags}" value="VEGAN" id="tagVegan">
                                                    <label class="form-check-label" for="tagVegan">
                                                        <i class="bi bi-flower1"></i> Vegan
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{dietaryTags}" value="GLUTEN_FREE" id="tagGlutenFree">
                                                    <label class="form-check-label" for="tagGlutenFree">
                                                        <i class="bi bi-check-circle"></i> Gluten Free
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{dietaryTags}" value="DAIRY_FREE" id="tagDairyFree">
                                                    <label class="form-check-label" for="tagDairyFree">
                                                        <i class="bi bi-droplet-half"></i> Dairy Free
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{dietaryTags}" value="KETO" id="tagKeto">
                                                    <label class="form-check-label" for="tagKeto">
                                                        <i class="bi bi-lightning"></i> Keto
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{dietaryTags}" value="LOW_CARB" id="tagLowCarb">
                                                    <label class="form-check-label" for="tagLowCarb">
                                                        <i class="bi bi-bar-chart"></i> Low Carb
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{dietaryTags}" value="HIGH_PROTEIN" id="tagHighProtein">
                                                    <label class="form-check-label" for="tagHighProtein">
                                                        <i class="bi bi-award"></i> High Protein
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{dietaryTags}" value="NUT_FREE" id="tagNutFree">
                                                    <label class="form-check-label" for="tagNutFree">
                                                        <i class="bi bi-x-circle"></i> Nut Free
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{dietaryTags}" value="PALEO" id="tagPaleo">
                                                    <label class="form-check-label" for="tagPaleo">
                                                        <i class="bi bi-fire"></i> Paleo
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" th:field="*{dietaryTags}" value="DIABETIC_FRIENDLY" id="tagDiabeticFriendly">
                                                    <label class="form-check-label" for="tagDiabeticFriendly">
                                                        <i class="bi bi-heart"></i> Diabetic Friendly
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                                <div class="section-divider"></div>

                                <!-- Nutritional Information (Optional) -->
                                <h4 class="mb-3">[[#{form.nutritionalInfo}]]</h4>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">[[#{form.caloriesPerServing}]]</label>
                                            <input type="number" class="form-control" th:field="*{calories}" min="0" th:placeholder="#{form.enterValue}">

                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">[[#{form.proteinPerServing}]]</label>
                                            <input type="number" class="form-control" th:field="*{protein}" min="0" step="0.1" th:placeholder="#{form.enterValue}">

                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">[[#{form.carbsPerServing}]]</label>
                                            <input type="number" class="form-control" th:field="*{carbs}" min="0" step="0.1" th:placeholder="#{form.enterValue}">

                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">[[#{form.fat}]]</label>
                                            <input type="number" class="form-control" th:field="*{fat}" min="0" step="0.1" th:placeholder="#{form.enterValue}">

                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">[[#{form.fiber}]]</label>
                                            <input type="number" class="form-control" th:field="*{fiber}" min="0" step="0.1"th:placeholder="#{form.enterValue}">

                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">[[#{form.sugar}]]</label>
                                            <input type="number" class="form-control" th:field="*{sugar}" min="0" step="0.1" th:placeholder="#{form.enterValue}">

                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">[[#{form.sodium}]]</label>
                                            <input type="number" class="form-control" th:field="*{sodium}" min="0" step="0.1" th:placeholder="#{form.enterValue}">

                                        </div>
                                    </div>
                                </div>

                                <div class="section-divider"></div>

                                <!-- Recipe Visibility -->
                                <div class="mb-4">
                                    <h4 class="mb-3">[[#{form.recipeVisibility}]]</h4>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" th:field="*{isPublic}" value="true" id="visibilityPublic">
                                                <label class="form-check-label" for="visibilityPublic">
                                                    <i class="bi bi-globe"></i> [[#{form.public}]]
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" th:field="*{isPublic}" value="false" id="visibilityPrivate">
                                                <label class="form-check-label" for="visibilityPrivate">
                                                    <i class="bi bi-lock"></i> [[#{form.private}]]
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="alert-warning" th:if="${#fields.hasErrors('isPublic')}" th:errors="*{isPublic}"></p>
                                </div>

                                <!-- Submit Buttons -->
                                <div class="d-flex justify-content-end gap-2 mt-4">
                                    <button type="submit" class="btn btn-primary"><i class="bi bi-check-lg"></i> [[#{form.publishRecipe}]]</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/one.js}"></script>
</body>
</html>