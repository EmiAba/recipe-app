<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Recipe Buddy</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
  <link th:href="@{/css/one.css}" rel="stylesheet">
</head>
<body>

<div class="dashboard-container">
  <div th:replace="~{fragments/navbar::navbar}"></div>

  <div class="main-content">
    <nav class="top-navbar">
      <div class="container-fluid">
        <div class="d-flex align-items-center"></div>
        <div class="d-flex align-items-center">
          <div th:replace="~{fragments/profile-menu :: profile-menu}"></div>
        </div>
      </div>
    </nav>

    <div class="dashboard-content">
      <div class="container-fluid py-4">

        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h2>[[#{admin.title}]]</h2>
            <p class="text-muted">[[#{admin.subtitle}]]</p>
          </div>
          <a th:href="@{/home}" class="btn btn-outline-secondary">[[#{admin.back}]]</a>
        </div>

        <p class="alert-warning" th:if="${errorMessage}" th:text="${errorMessage}"></p>
        <!-- Stats -->
        <div class="row mb-4">
          <div class="col-md-4">
            <div class="dashboard-card text-center">
              <div class="stat-value" th:text="${totalUsers}">0</div>
              <div class="stat-label">[[#{admin.users}]]</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="dashboard-card text-center">
              <div class="stat-value" th:text="${adminCount}">0</div>
              <div class="stat-label">[[#{admin.admins}]]</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="dashboard-card text-center">
              <div class="stat-value" th:text="${userCount}">0</div>
              <div class="stat-label">[[#{admin.regular}]]</div>
            </div>
          </div>
        </div>

        <!-- User Management -->
        <div class="dashboard-card">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>[[#{admin.users}]]</h4>
            <small class="text-muted" th:text="${totalUsers} + ' ' + #{admin.total}">0 total</small>
          </div>

          <div class="table-responsive">
            <table class="table">
              <thead>
              <tr>
                <th>[[#{admin.user}]]</th>
                <th>[[#{form.email}]]</th>
                <th>[[#{admin.role}]]</th>
                <th>[[#{admin.status}]]</th>
                <th>[[#{admin.joined}]]</th>
                <th>[[#{admin.actions}]]</th>
              </tr>
              </thead>
              <tbody>
              <tr th:each="user : ${users}">
                <td>
                  <div class="d-flex align-items-center">
                    <img th:src="${#strings.isEmpty(user.profilePicture) ? 'https://ui-avatars.com/api/?name=' + user.username : user.profilePicture}"
                         alt="" class="profile-img-small me-2" style="width: 32px; height: 32px; border-radius: 50%;">

                    <div>
                      <div th:text="${user.username}">Username</div>
                      <small class="text-muted" th:if="${user.firstName != null}" th:text="${user.firstName} + ' ' + ${user.lastName}">Name</small>
                    </div>
                  </div>
                </td>

                <td th:text="${user.email}">email@example.com</td>

                <td>
                  <span th:class="'badge ' + (${user.role.name() == 'ADMIN'} ? 'bg-danger' : 'bg-secondary')"
                        th:text="${user.role.name() == 'ADMIN' ? #messages.msg('admin.admin') : #messages.msg('admin.userRole')}">Role</span>
                </td>

                <td>
                  <span th:class="'badge ' + (${user.isActive()} ? 'bg-success' : 'bg-warning')"
                        th:text="${user.isActive() ? #messages.msg('admin.active') : #messages.msg('admin.inactive')}">Status</span>
                </td>

                <td>
                  <small th:text="${#temporals.format(user.createdOn, 'dd MMM yyyy')}">Jan 2025</small>
                </td>

                <td>
                  <div class="d-flex gap-1">
                    <!-- Role Management -->
                    <form th:if="${user.role.name() == 'USER'}"
                          th:action="@{/admin/users/{id}/ADMIN(id=${user.id})}"
                          th:method="patch" class="d-inline">
                      <button type="submit" class="btn btn-sm btn-outline-primary">
                        [[#{admin.makeAdmin}]]
                      </button>
                    </form>

                    <form th:if="${user.role.name() == 'ADMIN'}"
                          th:action="@{/admin/users/{id}/USER(id=${user.id})}"
                          th:method="patch" class="d-inline">
                      <button type="submit" class="btn btn-sm btn-outline-warning">
                        [[#{admin.removeAdmin}]]
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
              </tbody>
            </table>
          </div>

          <div th:if="${#lists.isEmpty(users)}" class="text-center py-4">
            <h5>[[#{admin.noUsers}]]</h5>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>